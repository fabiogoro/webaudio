<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>First test with WebAudio</title>
  <script type="text/javascript">
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    var oscillator = audioCtx.createOscillator();
    var gainNode = audioCtx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    var maxFreq = 6000;
    var maxVol = 0.02;

    var initialFreq = 3000;
    var initialVol = 0.001;

    oscillator.type = 'square';
    oscillator.frequency.value = initialFreq; // value in hertz
    oscillator.detune.value = 100; // value in cents
    oscillator.start(0);

    gainNode.gain.value = initialVol;

    var CurX;
    var CurY;

    document.onmoudexsemove = updatePage;

    function updatePage(e) {
      KeyFlag = false;

      CurX = (window.Event) ? e.pageX : event.clientX + (document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft);
      CurY = (window.Event) ? e.pageY : event.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop);

      oscillator.frequency.value = (CurX/WIDTH) * maxFreq;
      gainNode.gain.value = (CurY/HEIGHT) * maxVol;
    }

    var body = document.querySelector('body');

    var KeyX = 1;
    var KeyY = 0.01;
    var KeyFlag = false;

    body.onkeydown = function(e) {
      KeyFlag = true;

      // 37 is arrow left, 39 is arrow right,
      // 38 is arrow up, 40 is arrow down

      if(e.keyCode == 37) {
        KeyX -= 20;
      };

      if(e.keyCode == 39) {
        KeyX += 20;
      };

      if(e.keyCode == 38) {
        KeyY -= 20;
      };

      if(e.keyCode == 40) {
        KeyY += 20;
      };

      // set max and min constraints for KeyX and KeyY

      if(KeyX < 1) {
        KeyX = 1;
      };

      if(KeyX > WIDTH) {
        KeyX = WIDTH;
      };

      if(KeyY < 0.01) {
        KeyY = 0.01;
      };

      if(KeyY > HEIGHT) {
        KeyY = HEIGHT;
      };

      oscillator.frequency.value = (KeyX/WIDTH) * maxFreq;
      gainNode.gain.value = (KeyY/HEIGHT) * maxVol;
    }

  </script>
</head>
<body>
  <h1>Trying WebAudioAPI</h1>
  <p>Use mouse or arrow keys to control theremin.</p>

  <canvas class="canvas">
    Your browser does not support HTML5 canvas
  </canvas>
</body>
</html>
